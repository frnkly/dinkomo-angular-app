var nkomoLearningApp=angular.module("learn",["ngStorage","ngRoute","nkomo.controllers","nkomo.directives","nkomo.services","nkomo.rover"]),_appVersion="0.0.2",_isLocal="localhost"==window.location.hostname||window.location.hostname.match(/.*\.local$/i)||window.location.hostname.match(/.*\.vagrant$/i)?!0:!1,_assetVersion=_isLocal?Date.now():_appVersion,_apiEndpoint=_isLocal?"http://api.dinkomo.vagrant/v0.1":"http://dinkomo-api.frnk.ca/v0.1";nkomoLearningApp.constant("appVersion",_appVersion).constant("isLocalEnvironment",_isLocal).constant("assetVersion",_assetVersion).constant("apiEndpoint",_apiEndpoint);var nkomoServices=angular.module("nkomo.services",["nkomo.rover"]),nkomoDirectives=angular.module("nkomo.directives",["nkomo.rover"]),nkomoControllers=angular.module("nkomo.controllers",["nkomo.rover"]);nkomoLearningApp.config(["$routeProvider","assetVersion",function(o,e){return o.when("/",{redirectTo:"/dict"}).when("/about",{templateUrl:"/views/about.html?"+e,controller:"PageController"}).when("/account",{templateUrl:"/views/account.html?"+e,controller:"AccountController"}).when("/login",{templateUrl:"/views/login.html?"+e,controller:"AccountController"}).when("/stats",{templateUrl:"/views/stats.html?"+e,controller:"PageController"}).when("/dict/:searchTerm?",{templateUrl:"/views/search.html?"+e,controller:"SearchController"}).when("/:langCode",{templateUrl:"/views/search.html?"+e,controller:"SearchController"}).when("/:langCode/define/:searchTerm",{templateUrl:"/views/definition.html?"+e,controller:"DefinitionController"}).when("/:langCode/poem/:searchTerm",{templateUrl:"/views/poem.html?"+e,controller:"DefinitionController"}).otherwise({redirectTo:"/dict"})}]).run(["$rootScope","$location","Rover",function(o,e,n){n.debug("Running app...")}]);
angular.module("nkomo.controllers").controller("AccountController",["$scope","AccountService",function(o,e){return e.hasToken()?void 0:e.setCredentials()}]);
angular.module("nkomo.controllers").controller("DefinitionController",["$scope","$routeParams","$sessionStorage","LanguageFactory","DefinitionFactory","Rover",function(e,n,o,a,i,r){r.debug("DefinitionController"),e.searchTerm=n.searchTerm.replace("_"," "),e.langCode=n.langCode,e.language=o.languages[n.langCode]||null,e.language||(r.debug('Retrieving language with code "'+e.langCode+'"...'),a.get(e.langCode).then(function(a){e.language=o.languages[n.langCode]=a.data},function(e){r.debug("Could not retrieve language data.")})),e.definitions=o.definitions[n.searchTerm]||null,e.definitions||(r.debug('Retrieving definitions for "'+e.searchTerm+'"...'),i.search(e.searchTerm,"word",e.langCode).then(function(a){e.definitions=o.definitions[n.searchTerm]=a.data},function(e){r.debug("Could not retrieve definitions.")}))}]);
angular.module("nkomo.controllers").controller("MainController",["$scope","$sessionStorage","$localStorage","Rover","assetVersion",function(o,e,n,s,l){o.assetVersion=l,e.languages=e.languages||{},e.definitions=e.definitions||{},o.toggleNav=function(){$("aside .toggles").toggleClass("hidden-xs")}}]);
angular.module("nkomo.controllers").controller("PageController",["$scope",function(o){}]);
angular.module("nkomo.controllers").controller("SearchController",["$scope","$routeParams","$sessionStorage","LanguageFactory","DefinitionFactory","SearchFactory","Rover",function(e,n,a,o,r,t,u){u.debug("SearchController"),e.searchTerm=n.searchTerm?n.searchTerm.replace("_"," "):null,e.langCode=n.langCode,e.language=n.langCode?a.languages[n.langCode]||null:!1,null===e.language&&(u.debug('Retrieving language with code "'+e.langCode+'"...'),o.get(e.langCode).then(function(n){e.language=a.languages[e.langCode]=n.data},function(e){u.debug("Could not retrieve language data.")})),e.results=null,e.lookup=function(n,a){n=n||e.searchTerm,a=a||e.langCode,n.length<1||(a?e.lookupDefinition(n,a):e.lookupAnything(n,a))},e.lookupDefinition=function(n,a){u.debug('Looking up definitions matching "'+n+'"...'),e.results=[],e.isSearching=!0,r.search(n,"word",a).then(function(n){e.isSearching=!1,e.results=n.data},function(n){u.debug("Error"),u.debug(n),e.isSearching=!1})},e.lookupAnything=function(n,a){u.debug('Looking up anything matching "'+n+'"...'),e.results=[],e.isSearching=!0,t.any(n).then(function(n){e.isSearching=!1,e.results=n.data},function(n){u.debug("Error"),u.debug(n),e.isSearching=!1})},e.clear=function(){e.results=null,e.searchTerm=""},e.url=function(e){if(!e||!e.type)return"#/dict";var n="#/dict",a=e.title.replace(" ","_");switch(e.type){case"word":n="#/"+e.mainLanguage.code+"/define/"+a}return n},n.searchTerm&&e.lookup()}]);
angular.module("nkomo.services").service("AccountService",["$window","$sessionStorage","$route","$location",function(n,e,o,t){this.token=!1,this.hasToken=function(){return!1},this.setCredentials=function(){t.path("/login")}}]);
angular.module("nkomo.services").factory("DefinitionFactory",["$http","apiEndpoint",function(t,n){return{count:function(o){return o=o||"word",t.get(n+"/"+o+"/count")},search:function(o,r,e,u){e=e||"",r=r||"word";var c=n+"/"+r+"/search/"+o;return c+="?lang="+e,c+="&method=fulltext",t({method:"GET",url:c})}}}]);
angular.module("nkomo.services").factory("LanguageFactory",["$http","apiEndpoint",function(n,t){return{count:function(){return n.get(t+"/language/count")},get:function(u){return n.get(t+"/language/"+u)}}}]);
angular.module("nkomo.rover",[]).service("Rover",["$window","$sessionStorage","$route","$location",function(o,n,t,i){this.timestamp=Date.now(),this.isLocal="localhost"==window.location.hostname||window.location.hostname.match(/.*\.local$/i)||window.location.hostname.match(/.*\.vagrant$/i)?!0:!1,this.debug=function(o){this.isLocal&&console&&console.log(o)}}]);
angular.module("nkomo.services").factory("SearchFactory",["$http","apiEndpoint",function(t,n){return{any:function(e){return t.get(n+"/search/"+e+"?method=fulltext")}}}]);
//# sourceMappingURL=learn.js.map